<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Игровой автомат</title>
    <style>
        body {
            background-image: url('https://umbphotos.ag/images/375b18fa3ffcc616179b8cf6ed4732c6.webp'); /* Замените на URL вашего фонового изображения */
            background-repeat: no-repeat;
            background-size: cover;
            background-attachment: fixed;
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        .promo-screen, .slot-machine {
            display: none;
            flex-direction: column;
            align-items: center;
        }
        .promo-screen.active, .slot-machine.active {
            display: flex;
        }
        .promo-code-input {
            padding: 10px;
            font-size: 1em;
            border: 2px solid #000;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        .promo-button {
            padding: 10px 20px;
            font-size: 1em;
            cursor: pointer;
            background-color: gold;
            border: 2px solid #d4af37;
            color: black;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            border-radius: 5px;
        }
        .message {
            padding: 10px 20px;
            font-size: 1.2em;
            color: red;
            background-color: rgba(255, 255, 255, 0.8);
            border: 2px solid red;
            border-radius: 5px;
            display: none;
            margin-top: 10px;
        }
        .background-image {
            width: 100%;
            height: auto;
        }
        .reels {
            position: absolute;
            top: 48%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            justify-content: center;
        }
        .reel {
            width: 75px;
            height: 75px;
            margin: 0 5px;
            border: 2px solid #000;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2em;
            background-color: #fff;
            overflow: hidden;
            position: relative;
        }
        .reel-container {
            display: flex;
            flex-direction: column;
            position: absolute;
            top: 0;
        }
        .reel img {
            width: 75px;
            height: 75px;
        }
        .button {
            position: absolute;
            bottom: 20%;
            left: 50%;
            transform: translateX(-50%);
            padding: 50px 500px;
            font-size: 1.5em;
            cursor: pointer;
            background: none;
            border: none;
        }
        .button img {
            width: 300px;
            height: auto;
        }
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); /* Полупрозрачный фон */
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        .result-button {
            margin-top: 10px;
            padding: 10px 20px;
            font-size: 1em;
            cursor: pointer;
            background-color: gold;
            border: 2px solid #d4af37;
            color: black;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            border-radius: 5px;
            position: absolute;
            bottom: 5%;
            left: 50%;
            transform: translateX(-50%);
        }

        /* Адаптивные стили */
        @media (max-width: 600px) {
            .reel {
                width: 75px;
                height: 75px;
                font-size: 1.5em;
            }
            .button {
                padding: 20px 100px;
                bottom: 27%;
            }
            .button img {
                width: 200px;
            }
            .promo-code-input {
                width: 80%;
                font-size: 0.9em;
            }
            .result-button {
                font-size: 0.9em;
                padding: 8px 16px;
            }
        }

        @keyframes spin {
            0% { transform: translateY(0); }
            100% { transform: translateY(-100%); }
        }

        @keyframes stop {
            0% { transform: translateY(0); }
            100% { transform: translateY(-100%); }
        }
    </style>
</head>
<body>
    <div class="promo-screen active">
        <input type="text" id="promoCode" class="promo-code-input" placeholder="Введите промокод">
        <button class="promo-button" onclick="checkPromoCode()">Войти</button>
        <div id="message" class="message"></div>
    </div>
    <div class="slot-machine">
        <img src="https://umbphotos.ag/images/0dc3c426704977a191d565fd8738bb00.png" alt="Background" class="background-image">
        <div class="reels">
            <div class="reel" id="reel1">
                <div class="reel-container">
                    <img src="https://umbphotos.ag/images/2b11dac22ef9af9a3eb39a815cd1656a.png" alt="Symbol 1">
                    <img src="https://umbphotos.ag/images/500935a8280a75e8e44190339d42f0fb.png" alt="Symbol 2">
                    <img src="https://umbphotos.ag/images/cdb78ab758edb41837e8a48efa91a97f.png" alt="Symbol 3">
                </div>
            </div>
            <div class="reel" id="reel2">
                <div class="reel-container">
                    <img src="https://umbphotos.ag/images/6ad2efa5d7acf4527f298877c80838cf.png" alt="Symbol 4">
                    <img src="https://umbphotos.ag/images/b2383a68068f851edc375aa0bf02064b.png" alt="Symbol 5">
                    <img src="https://umbphotos.ag/images/509ad67b1d76b8dddbf23f318119c34a.png" alt="Symbol 6">
                </div>
            </div>
            <div class="reel" id="reel3">
                <div class="reel-container">
                    <img src="https://umbphotos.ag/images/2b11dac22ef9af9a3eb39a815cd1656a.png" alt="Symbol 1">
                    <img src="https://umbphotos.ag/images/500935a8280a75e8e44190339d42f0fb.png" alt="Symbol 2">
                    <img src="https://umbphotos.ag/images/cdb78ab758edb41837e8a48efa91a97f.png" alt="Symbol 3">
                </div>
            </div>
        </div>
        <button class="button" onclick="spin()">
            <img src="https://umbphotos.ag/images/1778e39465a58eee116c47fddbc8829c.png" alt="Крутить">
        </button>
        <audio id="spinSound" src="spin.mp3"></audio> <!-- Локальный аудиофайл -->
        <audio id="winSound" src="win.mp3"></audio> <!-- Локальный аудиофайл для победы -->
    </div>
    <div id="overlay" class="overlay">
        <img id="resultImage" class="result-image" src="" alt="Result" style="display: none;">
        <button id="resultButton" class="result-button" onclick="resetGame()">Попробуй еще раз</button>
    </div>

<script>
    const symbols = [
        'https://umbphotos.ag/images/2b11dac22ef9af9a3eb39a815cd1656a.png',
        'https://umbphotos.ag/images/500935a8280a75e8e44190339d42f0fb.png',
        'https://umbphotos.ag/images/cdb78ab758edb41837e8a48efa91a97f.png',
        'https://umbphotos.ag/images/6ad2efa5d7acf4527f298877c80838cf.png',
        'https://umbphotos.ag/images/b2383a68068f851edc375aa0bf02064b.png',
        'https://umbphotos.ag/images/509ad67b1d76b8dddbf23f318119c34a.png'
    ];

const winImageUrl = 'https://umbphotos.ag/images/d6d730ff59bf17e6daa9f16c6f5be53a.png'; // Замените на URL вашего изображения победы
    const telegramBotToken = '7775683186:AAGkwdGwDdc_5Mvpz6herg6kw_3CX6XCm1w'; // Замените на токен вашего Telegram бота
    const telegramChatId = '5920944588'; // Замените на ID чата администратора

    const promoCodes = [
        'A1B2C3D4', 'E5F6G7H8', 'I9J0K1L2', 'M3N4O5P6', 'Q7R8S9T0',
        'U1V2W3X4', 'Y5Z6A7B8', 'C9D0E1F2', 'G3H4I5J6', 'K7L8M9N0',
        'O1P2Q3R4', 'S5T6U7V8', 'W9X0Y1Z2', 'A3B4C5D6', 'E7F8G9H0',
        'I1J2K3L4', 'M5N6O7P8', 'Q9R0S1T2', 'U3V4W5X6', 'Y7Z8A9B0',
        'C1D2E3F4', 'G5H6I7J8', 'K9L0M1N2', 'O3P4Q5R6', 'S7T8U9V0',
        'W1X2Y3Z4', 'A5B6C7D8', 'E9F0G1H2', 'I3J4K5L6', 'M7N8O9P0',
        'Q1R2S3T4', 'U5V6W7X8', 'Y9Z0A1B2', 'C3D4E5F6', 'G7H8I9J0',
        'K1L2M3N4', 'O5P6Q7R8', 'S9T0U1V2', 'W3X4Y5Z6', 'A7B8C9D0',
        'E1F2G3H4', 'I5J6K7L8', 'M9N0O1P2', 'Q3R4S5T6', 'U7V8W9X0',
        'Y1Z2A3B4', 'C5D6E7F8', 'G9H0I1J2', 'K3L4M5N6', 'O7P8Q9R0',
        'S1T2U3V4', 'W5X6Y7Z8', 'A9B0C1D2', 'E3F4G5H6', 'I7J8K9L0',
        'M1N2O3P4', 'Q5R6S7T8', 'U9V0W1X2', 'Y3Z4A5B6', 'C7D8E9F0',
        'G1H2I3J4', 'K5L6M7N8', 'O9P0Q1R2', 'S3T4U5V6', 'W7X8Y9Z0'
    ];

    let attemptCount = localStorage.getItem('attemptCount') ? parseInt(localStorage.getItem('attemptCount')) : 0;
    let cycleCount = localStorage.getItem('cycleCount') ? parseInt(localStorage.getItem('cycleCount')) : 0;
    let hasWon = localStorage.getItem('hasWon') === 'true';
    let usedPromoCodes = JSON.parse(localStorage.getItem('usedPromoCodes')) || [];

    function checkPromoCode() {
        const promoCode = document.getElementById('promoCode').value;
        const messageElement = document.getElementById('message');

        if (!promoCodes.includes(promoCode) || usedPromoCodes.includes(promoCode)) {
            messageElement.textContent = 'Неверный или уже использованный промокод';
            messageElement.style.display = 'block';
            setTimeout(() => {
                messageElement.style.display = 'none';
            }, 3000); // Сообщение исчезнет через 3 секунды
            return;
        }

        document.querySelector('.promo-screen').classList.remove('active');
        document.querySelector('.slot-machine').classList.add('active');
    }

    function spin() {
        const promoCode = document.getElementById('promoCode').value;
        const spinSound = document.getElementById('spinSound');
        spinSound.play();

        let result;
        if (!hasWon && (attemptCount === 4 || Math.random() < 0.2)) { // Победа на последней попытке или с вероятностью 20%
            setReels(true);
            result = 'Победа';
            hasWon = true;
            localStorage.setItem('hasWon', hasWon);
        } else {
            setReels(false);
            result = 'Проигрыш';
        }

        attemptCount++;
        localStorage.setItem('attemptCount', attemptCount);
        usedPromoCodes.push(promoCode);
        localStorage.setItem('usedPromoCodes', JSON.stringify(usedPromoCodes));
        document.getElementById('promoCode').value = ''; // Очистить поле ввода промокода

        sendResultToTelegram(promoCode, result);

        if (attemptCount === 5) {
            resetCycle();
        }
    }

    function setReels(isWin) {
        const spinDuration = 10000; // Продолжительность вращения в миллисекундах
        const reelElements = [];
        const spinCount = 30; // Количество вращений

        for (let i = 1; i <= 3; i++) {
            const reel = document.getElementById(`reel${i}`);
            const reelContainer = reel.querySelector('.reel-container');
            reelElements.push(reelContainer);
            reelContainer.style.transition = 'none'; // Отключаем анимацию для мгновенного перемещения
            reelContainer.style.top = '0'; // Начальная позиция
            reelContainer.style.animation = `spin ${spinDuration / spinCount / 1000}s linear infinite`; // Устанавливаем анимацию
        }

        setTimeout(() => {
            for (let i = 0; i < reelElements.length; i++) {
                const reelContainer = reelElements[i];

                // Останавливаем вращение и устанавливаем конечный результат
                setTimeout(() => {
                    reelContainer.style.animation = 'none'; // Останавливаем анимацию
                    let randomSymbols = shuffleArray(symbols.slice()); // Перемешиваем символы
                    reelContainer.innerHTML = ''; // Очищаем контейнер
                    randomSymbols.forEach(symbol => {
                        const img = document.createElement('img');
                        img.src = symbol;
                        reelContainer.appendChild(img);
                    });
                    reelContainer.style.transition = 'none';
                    reelContainer.style.transform = 'translateY(0)';
                }, spinDuration);
            }
        }, 100); // Небольшая задержка перед началом анимации

        // Показать кнопку после завершения анимации
        setTimeout(() => {
            showResult(isWin);
        }, spinDuration + 100); // Добавляем небольшую задержку для завершения всех анимаций
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function showResult(isWin) {
        const overlay = document.getElementById('overlay');
        const resultImage = document.getElementById('resultImage');
        const resultButton = document.getElementById('resultButton');
        const winSound = document.getElementById('winSound');

        if (isWin) {
            resultImage.src = winImageUrl;
            resultImage.style.display = 'block';
            resultButton.textContent = '🎆Поздравляем🎆 Вы выиграли 1️⃣ грамм⚖️. Отправьте свой промокод🏷 и получите приз🎁 у оператора Kett💻';
            resultButton.onclick = () => window.location.href = telegramUrl;
            winSound.play();
        } else {
            resultImage.style.display = 'none'; // Убираем изображение при проигрыше
            resultButton.textContent = 'Попробуй еще раз';
            resultButton.onclick = resetGame;
        }

        overlay.style.display = 'flex';
    }

    function resetCycle() {
        attemptCount = 0;
        hasWon = false;
        cycleCount++;
        localStorage.setItem('attemptCount', attemptCount);
        localStorage.setItem('hasWon', hasWon);
        localStorage.setItem('cycleCount', cycleCount);
    }

    function resetGame() {
        const overlay = document.getElementById('overlay');
        overlay.style.display = 'none';
        document.querySelector('.slot-machine').classList.remove('active');
        document.querySelector('.promo-screen').classList.add('active');
    }

    function sendResultToTelegram(promoCode, result) {
        const message = `Промокод: ${promoCode}\nРезультат: ${result}`;
        const url = `https://api.telegram.org/bot${telegramBotToken}/sendMessage?chat_id=${telegramChatId}&text=${encodeURIComponent(message)}`;

        fetch(url)
            .then(response => response.json())
            .then(data => {
                if (!data.ok) {
                    console.error('Ошибка при отправке сообщения в Telegram:', data);
                }
            })
            .catch(error => {
                console.error('Ошибка при отправке сообщения в Telegram:', error);
            });
    }
</script>
</body>
</html>
